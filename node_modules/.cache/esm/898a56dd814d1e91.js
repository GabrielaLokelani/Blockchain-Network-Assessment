let Transaction,createDate,faucetPublicKeyComp,faucetAddress,faucetPrivKey,faucetmsg,MIEWCOIN_BLOCKCHAIN;_814‍.x([["faucetTransaction",()=>faucetTransaction],["initFaucetServer",()=>initFaucetServer]]);_814‍.w("./transaction",[["default",["Transaction"],function(v){Transaction=v}]]);_814‍.w("./block",[["createDate",["createDate"],function(v){createDate=v}]]);_814‍.w("./faucetWallet",[["faucetPublicKeyComp",["faucetPublicKeyComp"],function(v){faucetPublicKeyComp=v}],["faucetAddress",["faucetAddress"],function(v){faucetAddress=v}],["faucetPrivKey",["faucetPrivKey"],function(v){faucetPrivKey=v}],["faucetmsg",["faucetmsg"],function(v){faucetmsg=v}]]);_814‍.w("../index",[["MIEWCOIN_BLOCKCHAIN",["MIEWCOIN_BLOCKCHAIN"],function(v){MIEWCOIN_BLOCKCHAIN=v}]]);// IMPORT RELEVANT LIBRARIES
const CryptoJS = require('crypto-js');
const EC = require('elliptic').ec;
const ec = new EC('secp256k1');
var crypto = require('crypto');
const express = require('express');
const path = require('path')





const faucetHttp_port = process.env.FAUCET_PORT || 7777;

// create the faucet transaction, sign the faucet transaction, and push to the pendingTranactions pool to be mined
       function faucetTransaction(toAddress, requestAmount) {
    if (requestAmount <= 1000000 && toAddress) {
        const faucetTXN = new (_814‍.a("Transaction",Transaction))((_814‍.a("faucetAddress",faucetAddress)), toAddress, requestAmount, 0, _814‍.a("createDate",createDate)(), "faucet tx", (_814‍.a("faucetPublicKeyComp",faucetPublicKeyComp)));
        faucetTXN.signTransaction(_814‍.a("faucetPrivKey",faucetPrivKey), _814‍.a("faucetmsg",faucetmsg));
        _814‍.a("MIEWCOIN_BLOCKCHAIN",MIEWCOIN_BLOCKCHAIN).pendingTransactions.push(faucetTXN);
        return faucetTXN;
    } else {
        throw new Error("Sorry, either your request amount has exceeted the limit or your address is missing");
    }
    
}

// create the faucet server for faucet app
       function initFaucetServer() {
    let app = express();
    app.use(express.urlencoded({ extended: false }));
    app.use(express.json());
    app.set('view engine', 'ejs');
    app.engine('html', require('ejs').renderFile);
    app.use(express.static('public'));

        // get faucet page
        app.get('/faucet', (req, res) => {
            res.render('../views/faucet.html');
        });
    
        // get miewcoins from the faucet after putting in address and passing reCAPTCHA validation (see reCAPTCHA in html)
        app.post('/faucet', (req, res) => {
            // faucetTransaction(req.body.toAddress, req.body.requestAmount);
            let toAddress = req.body.toAddress;
            let requestAmount = req.body.requestAmount;
            let txn = faucetTransaction(toAddress, requestAmount);
            res.send(`Here is your Faucet Transaction Hash: ${txn.transactionHash}`);
        });

    app.listen(faucetHttp_port, () => _814‍.g.console.log('Faucet listening http on port: ' + faucetHttp_port));    
}

// function drawView(res, view, data) {
//     res.render('../views/' + view + '.html', data)
// }

            // .then((transaction) => {
            //     drawView(res, 'faucet', {
            //         toAddress: toAddress,
            //         requestAmount: requestAmount
            //     })
            // })

// initFaucetServer();
